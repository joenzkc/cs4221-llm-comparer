<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDL comparison</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
    <div class="container mt-2">
        <div class="row">
            <form class="form w-100" onsubmit="return handleSubmit(event)">
                <label for="requirements">Requirements</label>
                <textarea name="requirements" id="requirements" rows="5" class="form-control"></textarea>
                
                <button class="btn btn-primary my-2">Submit</button>
            </form> 
        </div>
        <div class="row">
            <div class="col-md-6">
                <h3>Open AI</h3>
                <pre>
                    <code 
                        id='openaiResponse' 
                        code='language-sql'
                        class='hljs language-sql'
                    ></code>
                </pre>
            </div>
            <div class="col-md-6">
                <h3>Claude</h3>
                <pre>
                    <code id='claudeResponse' code="language-sql" class='hljs language-sql'></code>
                </pre>
            </div>
        </div>
    </div>
    <script>
        hljs.highlightAll();

        async function handleSubmit(e) {
            e.preventDefault();
            let requirements = document.getElementById('requirements').value;
            console.log(requirements);
            let dlls = await fetch('/generate_ddl', {
                method: 'POST',
                body: JSON.stringify({
                    'requirements': requirements
                }),
                headers: {
                    'Content-type': 'application/json'
                }
            }).then(data => data.json());
            let {openai, claude} = dlls;
            console.log(dlls);

            let openaiDDL = '';
            for (let match of openai.matchAll(/(?:```sql)?\n([\s\S]*?)(?:```)/g)) {
                let [_, matchStr] = match;
                openaiDDL += '\n' + matchStr;
            }
            console.log(openaiDDL);
            document.getElementById('openaiResponse').removeAttribute('data-highlighted')
            document.getElementById('openaiResponse').textContent = openaiDDL;

            hljs.highlightAll();
            // document.getElementById('claudeResponse').innerText = claude;
        }   
    </script>
</body>
</html>